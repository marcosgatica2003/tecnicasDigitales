
#if defined(__XC16__)
    #include <xc.h>
#elif defined(__C30__)
    #if defined(__dsPIC33E__)
    	#include <p33Exxxx.h>
    #elif defined(__dsPIC33F__)
    	#include <p33Fxxxx.h>
    #endif
#endif


#include <stdint.h>        
#include <dsp.h>  
#include <stdbool.h>      

#include "system.h"        
#include "user.h"          


/*Variable global del tipo FIRStruct*/
FIRStruct filtroFIR;  //(1)

/*Vector de coeficientes de M(399) taps, ubicado en memoria X (xmemory) y 
 alineado a la menor potencia de 2 mayor que 2*M (2^10=1024)*/
//K = 10, K = menor potencia de 2 mayor que 2*M = 798 -> 2^10 =1024;
fractional taps[M]__attribute__((space(xmemory), aligned(K))) = { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0001,0x0001,0x0001,0x0000,
0x0000,0xffff,0xffff,0xffff,0xffff,0xffff,0x0000,0x0000,0x0001,0x0002,0x0002,0x0002,0x0001,0x0000,0xffff,0xfffe,
0xfffd,0xfffd,0xfffe,0xffff,0x0001,0x0002,0x0003,0x0004,0x0003,0x0002,0x0000,0xfffe,0xfffd,0xfffc,0xfffc,0xfffd,
0xffff,0x0001,0x0003,0x0004,0x0004,0x0003,0x0002,0x0000,0xffff,0xfffe,0xfffd,0xfffe,0xffff,0x0000,0x0000,0x0001,
0x0000,0x0000,0xffff,0xffff,0x0000,0x0001,0x0003,0x0004,0x0005,0x0004,0x0002,0xfffe,0xfffa,0xfff6,0xfff4,0xfff5,
0xfff9,0xffff,0x0008,0x0010,0x0015,0x0016,0x0011,0x0008,0xfffa,0xffec,0xffe1,0xffdc,0xffdf,0xffeb,0xfffe,0x0014,
0x0027,0x0034,0x0035,0x0029,0x0012,0xfff3,0xffd5,0xffbe,0xffb4,0xffbc,0xffd5,0xfffb,0x0026,0x004c,0x0063,0x0064,
0x004d,0x0022,0xffea,0xffb4,0xff8b,0xff7b,0xff89,0xffb5,0xfff7,0x003f,0x007d,0x00a2,0x00a3,0x007e,0x0038,0xffe0,
0xff8a,0xff4a,0xff32,0xff49,0xff8d,0xfff0,0x005c,0x00b8,0x00ef,0x00ef,0x00b8,0x0052,0xffd4,0xff5b,0xff02,0xfee0,
0xff01,0xff5f,0xffe6,0x007a,0x00f7,0x013f,0x0140,0x00f6,0x0070,0xffca,0xff2c,0xfeb9,0xfe8f,0xfeb9,0xff30,0xffdc,
0x0095,0x0131,0x018b,0x018b,0x0130,0x008c,0xffc3,0xff04,0xfe7b,0xfe49,0xfe7b,0xff08,0xffd1,0x00a9,0x015e,0x01c5,
0x01c5,0x015d,0x00a3,0xffc1,0xfeea,0xfe51,0xfe19,0xfe51,0xfeec,0xffc8,0x00b3,0x0176,0x01e5,0x01e5,0x0176,0x00b0,
0xffc2,0xfee2,0xfe42,0x7e09,0xfe42,0xfee2,0xffc2,0x00b0,0x0176,0x01e5,0x01e5,0x0176,0x00b3,0xffc8,0xfeec,0xfe51,
0xfe19,0xfe51,0xfeea,0xffc1,0x00a3,0x015d,0x01c5,0x01c5,0x015e,0x00a9,0xffd1,0xff08,0xfe7b,0xfe49,0xfe7b,0xff04,
0xffc3,0x008c,0x0130,0x018b,0x018b,0x0131,0x0095,0xffdc,0xff30,0xfeb9,0xfe8f,0xfeb9,0xff2c,0xffca,0x0070,0x00f6,
0x0140,0x013f,0x00f7,0x007a,0xffe6,0xff5f,0xff01,0xfee0,0xff02,0xff5b,0xffd4,0x0052,0x00b8,0x00ef,0x00ef,0x00b8,
0x005c,0xfff0,0xff8d,0xff49,0xff32,0xff4a,0xff8a,0xffe0,0x0038,0x007e,0x00a3,0x00a2,0x007d,0x003f,0xfff7,0xffb5,
0xff89,0xff7b,0xff8b,0xffb4,0xffea,0x0022,0x004d,0x0064,0x0063,0x004c,0x0026,0xfffb,0xffd5,0xffbc,0xffb4,0xffbe,
0xffd5,0xfff3,0x0012,0x0029,0x0035,0x0034,0x0027,0x0014,0xfffe,0xffeb,0xffdf,0xffdc,0xffe1,0xffec,0xfffa,0x0008,
0x0011,0x0016,0x0015,0x0010,0x0008,0xffff,0xfff9,0xfff5,0xfff4,0xfff6,0xfffa,0xfffe,0x0002,0x0004,0x0005,0x0004,
0x0003,0x0001,0x0000,0xffff,0xffff,0x0000,0x0000,0x0001,0x0000,0x0000,0xffff,0xfffe,0xfffd,0xfffe,0xffff,0x0000,
0x0002,0x0003,0x0004,0x0004,0x0003,0x0001,0xffff,0xfffd,0xfffc,0xfffc,0xfffd,0xfffe,0x0000,0x0002,0x0003,0x0004,
0x0003,0x0002,0x0001,0xffff,0xfffe,0xfffd,0xfffd,0xfffe,0xffff,0x0000,0x0001,0x0002,0x0002,0x0002,0x0001,0x0000,
0x0000,0xffff,0xffff,0xffff,0xffff,0xffff,0x0000,0x0000,0x0001,0x0001,0x0001,0x0000,0x0000,0x0000,0x0000,0x0000,
0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000};//(2)Vector de retardos 

fractional delay[M]__attribute__((space(ymemory), far, aligned(K)));  //(3)vector de retardo 

unsigned int aux[32];

/*Buffer del ADC1, con las muestras sin filtrar*/
unsigned int RightBufferA[32]__attribute__((space(dma)));
unsigned int RightBufferB[32]__attribute__((space(dma)));

/*Buffer donde se almacena las muestras filtradas*/
unsigned int LeftBufferA[32]__attribute__((space(dma)));
unsigned int LeftBufferB[32]__attribute__((space(dma)));

//unsigned int LeftBufferA[16]__attribute__((space(dma))) = {0x0000, 0x18f9, 0x30fc, 0x471d, 0x5a82, 0x6a6e, 0x7642, 0x7d8a, 0x7fff, 0x7d8a, 0x7642, 0x6a6e, 0x5a82, 0x471d, 0x30fc, 0x18f9};
//unsigned int LeftBufferB[16]__attribute__((space(dma))) = {0x0000, 0xe707, 0xcf04, 0xb8e3, 0xa57e, 0x9592, 0x89be, 0x8276, 0x8000, 0x8276, 0x89be, 0x9592, 0xa57e, 0xb8e3, 0xcf04, 0xe707};




int16_t main(void) 
{
    /* Configure the oscillator for the device */
    ConfigureOscillator();
    //configtimer();//configuración del timer
    //ConfigureDAC();
    //ConfigureDMA();
    InitApp();
    
    while(1)
    {
    }
}


